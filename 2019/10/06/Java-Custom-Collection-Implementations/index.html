<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Java,Collection,">










<meta name="description" content="This is a simple introduction about Java Custom Collection Implementations, including why and how to write a custom implementation and the Interoperability (Compatibility and API Design)">
<meta name="keywords" content="Java,Collection">
<meta property="og:type" content="article">
<meta property="og:title" content="Java Custom Collection Implementations">
<meta property="og:url" content="http://yoursite.com/2019/10/06/Java-Custom-Collection-Implementations/index.html">
<meta property="og:site_name" content="HLR&#39;s Blog">
<meta property="og:description" content="This is a simple introduction about Java Custom Collection Implementations, including why and how to write a custom implementation and the Interoperability (Compatibility and API Design)">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-10-06T14:46:34.967Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java Custom Collection Implementations">
<meta name="twitter:description" content="This is a simple introduction about Java Custom Collection Implementations, including why and how to write a custom implementation and the Interoperability (Compatibility and API Design)">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"right","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/10/06/Java-Custom-Collection-Implementations/">





  <title>Java Custom Collection Implementations | HLR's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HLR's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-github">
          <a href="https://github.com/hlr7999" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-github"></i> <br>
            
            github
          </a>
        </li>
      
        
        <li class="menu-item menu-item-email">
          <a href="mailto:hlr7999@qq.com" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-envelope"></i> <br>
            
            email
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/10/06/Java-Custom-Collection-Implementations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="HLR">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HLR's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Java Custom Collection Implementations</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-10-06T22:45:44+08:00">
                2019-10-06
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>This is a simple introduction about Java Custom Collection Implementations, including why and how to write a custom implementation and the Interoperability (Compatibility and API Design)</p>
<a id="more"></a>

<h4 id="Reason-to-Write-an-Implementation"><a href="#Reason-to-Write-an-Implementation" class="headerlink" title="Reason to Write an Implementation"></a>Reason to Write an Implementation</h4><ul>
<li><strong>Persistent</strong> : You can implement a veneer Collection over an external database to make it persistent.</li>
<li><strong>Application-specific</strong></li>
<li><strong>High-performance, special-purpose</strong> : Many data structures take advantage of restricted usage to offer better performance than is possible with general-purpose implementations</li>
<li><strong>High-performance, general-purpose</strong> : Maybe you can come up with Java Collections Framework that is faster!</li>
<li><strong>Enhanced functionality</strong></li>
<li><strong>Convenience</strong></li>
<li><strong>Adapter</strong> : You can write an adapter implementation that permits other collections to operate in the Java Collections Framework</li>
</ul>
<h4 id="How-to-Write-a-Custom-Implementation"><a href="#How-to-Write-a-Custom-Implementation" class="headerlink" title="How to Write a Custom Implementation"></a>How to Write a Custom Implementation</h4><ul>
<li><p><strong>Views and Wrappers</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">asList</span><span class="params">(T[] a)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyArrayList&lt;T&gt;(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyArrayList</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T[] a;</span><br><span class="line"></span><br><span class="line">    MyArrayList(T[] array) &#123;</span><br><span class="line">        a = array;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">set</span><span class="params">(<span class="keyword">int</span> index, T element)</span> </span>&#123;</span><br><span class="line">        T oldValue = a[index];</span><br><span class="line">        a[index] = element;</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Process</strong></p>
<ol>
<li>Choose the appropriate abstract implementation class.</li>
<li>Provide implementations for all the abstract methods of the class. If your custom collection is to be modifiable, you will have to override one or more of the concrete methods as well. </li>
<li>Test and, if necessary, debug the implementation. </li>
<li>If you are concerned about performance, read the API documentation of the abstract implementation class for all the methods whose implementations you’re inheriting. If any seem too slow, override them. (Often this step is best omitted.)</li>
</ol>
</li>
</ul>
<h4 id="Compatibility"><a href="#Compatibility" class="headerlink" title="Compatibility"></a>Compatibility</h4><ul>
<li><p><strong>Upward Compatibility</strong></p>
<p>Suppose the old API returns an array of objects and the new API requires a Collection. You can use <code>Arrays.asList</code> to pass an array to any method requiring a <code>Collection</code> or a <code>List</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Foo[] result = oldAPI(args);</span><br><span class="line">newAPI(Arrays.asList(result));</span><br></pre></td></tr></table></figure>

<p>If the old API returns a <code>Vector</code> or a <code>Hashtable</code>, you can directly pass it to any method requiring a <code>Collection</code> or a <code>List</code> cause they were retrofitted to implement the <code>List</code> and <code>Map</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vector result = oldAPI(args);</span><br><span class="line">newAPI(result);</span><br></pre></td></tr></table></figure>

<p>If the old API returns an <code>Enumeration</code>. You can use <code>Collections.list</code> to translates an <code>Enumeration</code> to <code>Collection</code>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Enumeration e = oldAPI(args);</span><br><span class="line">newAPI(Collections.list(e));</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>Backward Compatibility</strong></p>
<p>Suppose the new API returns a <code>Collection</code> and the old API requires an array of Object. You can use <code>toArray</code> method to deal with it.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Collection c = newAPI();</span><br><span class="line">oldAPI(c.toArray());</span><br></pre></td></tr></table></figure>

<p>What if the old API requires an array of <code>String</code> (or another type) instead of an array of <code>Object</code>? You just use the other form of <code>toArray</code> — the one that takes an array on input.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Collection c = newAPI();</span><br><span class="line">oldAPI((String[]) c.toArray(<span class="keyword">new</span> String[<span class="number">0</span>]));</span><br></pre></td></tr></table></figure>

<p>If the old API requires a <code>Vector</code> or a <code>HashTable</code>, the standard collection constructor comes in handy.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Collection c = newAPI();</span><br><span class="line">oldAPI(<span class="keyword">new</span> Vector(c));</span><br></pre></td></tr></table></figure>

<p>If the old API returns an <code>Enumeration</code>. You can use <code>Collections.enumeration</code> to translates an <code>Collection</code> to <code>Enumeration</code> .</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Collection c = newAPI();</span><br><span class="line">oldAPI(Collections.enumeration(c));</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="API-Design"><a href="#API-Design" class="headerlink" title="API Design"></a>API Design</h4><ul>
<li><p><strong>Parameters</strong></p>
<p>If your API requires a collection on input, it is important to declare the parameter type to be one of the collection <a href="https://docs.oracle.com/javase/tutorial/collections/interfaces/index.html" target="_blank" rel="noopener">interface</a> types. <strong>Never</strong> use an <a href="https://docs.oracle.com/javase/tutorial/collections/implementations/index.html" target="_blank" rel="noopener">implementation</a> type because this defeats the purpose of an interface-based Collections Framework, which is to allow collections to be manipulated without regard to implementation details.</p>
<p>Further, you should always use the least-specific type that makes sense. For example, don’t require a <code>List</code>or a <code>Set</code>if a <code>Collection</code>would do. As a general rule, however, the best types to use on input are the most general: <code>Collection</code> and <code>Map</code>.</p>
</li>
<li><p><strong>Return Values</strong></p>
<p>It is much more flexible with return values than with input parameters. It’s fine to return an object of any type that implements or extends one of the collection interfaces. </p>
<p>In one sense, return values should have the opposite behavior of input parameters: It’s best to return the most specific applicable collection interface rather than the most general. </p>
</li>
<li><p><strong>Legacy APIs</strong></p>
<p>There are currently plenty of APIs that define their own ad hoc collection types. Suppose you own one of these APIs; here’s what you can do about it.</p>
<p>If possible, retrofit your legacy collection type to implement one of the standard collection interfaces. If this is impossible, define an <code>Adapter</code> class that wraps one of your legacy collections objects, allowing it to function as a standard collection.</p>
<p> if possible, retrofit your API with new calls that follow the input guidelines to accept objects of a standard collection interface. Such calls can coexist with the calls that take the legacy collection type. If this is impossible, provide a constructor or static factory for your legacy type that takes an object of one of the standard interfaces and returns a legacy collection containing the same elements. </p>
</li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Java/" rel="tag"># Java</a>
          
            <a href="/tags/Collection/" rel="tag"># Collection</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/18/hello-world/" rel="next" title="Hello World">
                <i class="fa fa-chevron-left"></i> Hello World
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="HLR">
            
              <p class="site-author-name" itemprop="name">HLR</p>
              <p class="site-description motion-element" itemprop="description">专业摸鱼</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">categories</span>
                
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Reason-to-Write-an-Implementation"><span class="nav-number">1.</span> <span class="nav-text">Reason to Write an Implementation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#How-to-Write-a-Custom-Implementation"><span class="nav-number">2.</span> <span class="nav-text">How to Write a Custom Implementation</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Compatibility"><span class="nav-number">3.</span> <span class="nav-text">Compatibility</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#API-Design"><span class="nav-number">4.</span> <span class="nav-text">API Design</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">HLR</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
